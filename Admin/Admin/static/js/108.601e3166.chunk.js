"use strict";(self.webpackChunkpest_admin=self.webpackChunkpest_admin||[]).push([[108],{86460:function(e,t,s){var a=s(66585);t.Z={CreateQrcode:e=>a.Z.Post("qrcode/createQr",e),GetQrcodes:e=>a.Z.Get("qrcode/getQrcode",e),DeletedQrcode:e=>{const t=`qrcode/deleteQrcode/${e}`;return a.Z.Post(t,e)},GetTotalQrcodes:e=>a.Z.Get("qrcode/totalQrcodes",e),getQrcodeById:e=>{const t=`qrcode/getQrcodeById/${e}`;return a.Z.Get(t,e)},detleteQrTitle:e=>a.Z.Post("qrcode/deleteTitle",e)}},81325:function(e,t,s){var a=s(66585);t.Z={createTechnician:e=>a.Z.Post("technician/createTechnician",e),technicianList:e=>a.Z.Get("technician/getTechnician",e),technicianTask:e=>a.Z.Get("task/getTasks",e),createTechnicianTask:e=>a.Z.Post("task/createTask",e),DeleteTechinician:e=>{let t=`technician/delete/${e}`;return a.Z.Post(t)},DeletedTechnician:e=>a.Z.Get("technician/all/deletedTechnician",e),RestoreTechnician:e=>{const t=`technician/delete/technician/${e}`;return a.Z.Post(t)},TechnicianCount:e=>a.Z.Get("company/totalTechnician",e),StartTaskCount:e=>a.Z.Get("task/start/taskcount",e),OngoingTaskCount:e=>a.Z.Get("task/ongoing/taskcount",e),CompletedTaskCount:e=>a.Z.Get("task/completed/taskcount",e),RegisterTechnicican:e=>a.Z.Post("otherauth/technicianRegister",e),EditTechnician:e=>{const t=`technician/editTechnician/${e.id}`;return a.Z.Post(t,e)},GetReports:e=>a.Z.Get("task/completedTaskDetails/",e),deleteTask:e=>a.Z.Post("task/delete/task",e)}},28334:function(e,t,s){s.r(t);var a=s(47313),l=s(97890),c=s(29385),n=s(36975),i=s(1397),r=s(98718),o=s(81325),d=s(69421),h=s(86460),m=s(70816),u=s.n(m),x=s(41948),v=s(14069),g=s(48964),f=s(97440),j=s(65213),p=s(46417);t.default=()=>{const{technicianId:e}=(0,l.UO)(),[t,s]=(0,a.useState)(""),[m,y]=(0,a.useState)(""),[N,S]=(0,a.useState)([]),[C,b]=(0,a.useState)(""),[k,P]=(0,a.useState)([]),[T,Z]=(0,a.useState)(""),[G,R]=(0,a.useState)(""),[Q,E]=(0,a.useState)(!1),[q,w]=(0,a.useState)(""),[A,D]=(0,a.useState)(""),[W,z]=(0,a.useState)(),[I,F]=(0,a.useState)([]),[Y,_]=(0,a.useState)("N/A"),[$,B]=(0,a.useState)([]),[H,M]=(0,a.useState)(!0),[L,O]=(0,a.useState)(),[K,U]=(0,a.useState)(),[J,V]=(0,a.useState)(),[X,ee]=(0,a.useState)(),[te,se]=(0,a.useState)(),[ae,le]=(0,a.useState)(),[ce,ne]=(0,a.useState)([]),ie=(0,l.TH)(),re=(0,l.s0)(),[oe,de]=(0,a.useState)(""),[he,me]=(0,a.useState)(""),[ue,xe]=(0,a.useState)(""),[ve,ge]=(0,a.useState)(),[fe,je]=(0,a.useState)(""),[pe,ye]=(0,a.useState)([]),[Ne,Se]=(0,a.useState)(""),[Ce,be]=(0,a.useState)(""),[ke,Pe]=(0,a.useState)(""),[Te,Ze]=(0,a.useState)(""),[Ge,Re]=(0,a.useState)(""),[Qe,Ee]=(0,a.useState)(!1);(0,a.useEffect)((()=>{1==I.length?I.map((e=>{const t=e.serviceName;Re(t)})):0==I.length&&Re(""),console.log("allQravailable",Ge)}),[I]),(0,a.useEffect)((()=>{We()}),[]),(0,a.useEffect)((()=>{y("start"),w(e)}),[e]),(0,a.useEffect)((()=>{ie.state&&ie.state.data?(s(ie.state.data),E(!0)):qe(),Ae()}),[ie.state,e]),(0,a.useEffect)((()=>{W&&we()}),[W]),(0,a.useEffect)((()=>{_e()}),[I]),(0,a.useEffect)((()=>{Q&&Z("")}),[Q]);const qe=async()=>{Ee(!0);try{const t=await o.Z.technicianList(e);s(t.data)}catch(t){console.error("Error fetching technician details:",t)}finally{Ee(!1)}},we=async()=>{Ee(!0);try{const e=await h.Z.GetQrcodes();console.log("qr",e);const t=e.data.data.filter((e=>e.customerId===W));F(t);const s=t.map((e=>e.serviceName));xe(s)}catch(e){console.error("Error fetching QR codes:",e)}finally{Ee(!1)}},Ae=async()=>{await De(),await ze()},De=async()=>{Ee(!0);try{const e=(await r.Z.getCompany()).data.Results;S(e)}catch(e){console.error("Error fetching companies:",e)}finally{Ee(!1)}},We=async()=>{Ee(!0);try{var e;const t=await d.Z.GetCateogry(),s=null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.Results.filter((e=>"main"===e.categoryType)),a=s.map(((e,t)=>({...e,key:e._id})));me(a)}catch(t){console.error("Error fetching service data:",t),x.Am.error("Failed to fetch service data")}finally{Ee(!1)}},ze=async()=>{Ee(!0);try{const e=await i.Z.ListServices();P(e.data.Results)}catch(e){console.error("Error fetching services:",e)}finally{Ee(!1)}},Ie=()=>{Ye()},Fe=()=>{E(!1),re("/tech/create/task")},Ye=async()=>{Ee(!0);try{var t;if(!(C&&A&&G&&e&&0!==Ce.length))return x.Am.error("All fields are required"),de(""),je(""),B([]),void E(!0);if(Ce.includes("General Pest Control")&&!fe)return x.Am.error("All fields are required"),void E(!0);const s=$.map((e=>e.serviceName));let a=[],l={category:"General Pest Control"};s.map((e=>{let t={subCategory:e,status:!1,skip:!1};a.push(t)}));let c=[];const n={category:l.category,subCategory:$.map((e=>e.serviceName)),subCategoryStatus:a};(0!=a.length&&"Rodent Pro"==(null===(t=pe[0])||void 0===t?void 0:t.serviceName)||0!=a.length&&0==(null===pe||void 0===pe?void 0:pe.length))&&c.push(n);let i=[],r={subCategory:"Rodent Pro",status:!1,skip:!1};i.push(r),Ze(i);const d=oe.map((e=>e.label)),h=ue&&ue.map(((e,t)=>d.includes(e)&&"Rodent Pro"!=e?{category:e,subCategory:$.map((e=>e.serviceName)),subCategoryStatus:a}:d.includes(e)&&"Rodent Pro"==e?{category:e,subCategory:"Rodent Pro",subCategoryStatus:i}:void 0));console.log("cat",h);const u=h.filter((e=>null!=e)),v=u&&u.map((e=>e.category));if(Se(v),I&&I.length>0)if(1==I.length){I.map((e=>e.serviceName))}else c=[];const g={serviceName:s,noqrcodeService:c,QrCodeCategory:u,mainCategory:oe.label,qrDetails:pe,companyName:C,startDate:A,description:G,status:m,customerId:W,available:Y,titles:J,qrTitle:K,numQRCodes:X},f={customerId:W,technicianId:e,taskDetails:g};await o.Z.createTechnicianTask(f),x.Am.success("Task Created Successfully"),re("/tech/assigned/task")}catch(s){console.error("Error creating task:",s.message),x.Am.error("Failed to create task. Please try again later.")}finally{Ee(!1)}},_e=()=>{const e=I.map((e=>({serviceName:e.serviceName,titles:e.titles,qrTitle:e.qrTitle})));ne(e),U(e.qrTitle),V(e.titles),ee(e.numQRCodes);const t=I.some((e=>"YES"===e.available));_(t?"Yes":"N/A")},$e={control:e=>({...e,cursor:"pointer"}),menu:e=>({...e,zIndex:9999,cursor:"pointer"}),option:(e,t)=>({...e,cursor:"pointer",backgroundColor:t.isSelected?"#f2f2f2":"transparent","&:hover":{backgroundColor:"#e6e6e6"},color:t.isSelected?"blue":"black",fontWeight:t.isSelected?"bold":"normal",padding:10})};return console.log("catogetry",ve),console.log("slected",Ce),console.log("subCategory",fe),console.log("allser",k),(0,p.jsxs)("div",{children:[Qe&&(0,p.jsx)(j.Z,{show:Qe}),(0,p.jsxs)(c.Z,{show:Q,onHide:Ie,size:"lg",style:{fontFamily:"Poppins",fontSize:"14px"},children:[(0,p.jsx)(c.Z.Header,{closeButton:!0,onHide:Fe,children:(0,p.jsx)(c.Z.Title,{style:{fontSize:"18px",fontWeight:"600"},children:"Create Task"})}),(0,p.jsx)(c.Z.Body,{children:(0,p.jsxs)(p.Fragment,{children:[t&&(0,p.jsxs)("div",{className:"mt-4",children:[(0,p.jsxs)("div",{className:"d-flex gap-4",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"Technician Name"})}),(0,p.jsx)("h6",{children:":"}),(0,p.jsxs)("p",{children:[t.firstName," ",t.lastName]})]}),(0,p.jsxs)("div",{className:"d-flex gap-4",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"Technician Email"})}),(0,p.jsx)("h6",{children:":"}),(0,p.jsx)("p",{children:t.email})]}),(0,p.jsxs)("div",{className:"d-flex gap-4",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"Technician Phone"})}),(0,p.jsx)("h6",{children:":"}),(0,p.jsx)("p",{children:t.phoneNumber})]})]}),(0,p.jsxs)("div",{className:" col-12 d-flex gap-4 mt-3",children:[(0,p.jsx)("div",{className:"col-3 d-flex align-items-center",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"Customer Name"})}),(0,p.jsx)("h6",{className:"d-flex align-items-center",children:":"}),(0,p.jsx)("div",{className:"col-4",children:(0,p.jsx)(g.ZP,{options:N.map((e=>({value:e.name,label:e.name,_id:e._id}))),onChange:e=>{e&&(b(e.value),z(e._id),_e())},value:ae,isSearchable:!0})}),(0,p.jsx)("div",{className:"col-12 d-flex align-items-center",children:(0,p.jsx)("button",{style:{fontSize:"13px"},id:"cbt",onClick:()=>re("/add/details"),className:"btn btn-primary",children:"Add New Customer"})})]}),(0,p.jsxs)("div",{className:"col-12 d-flex gap-4 mt-4",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"QR Code Available?"})}),(0,p.jsx)("h6",{children:":"}),Y]}),(0,p.jsxs)("div",{className:"col-12 d-flex gap-4 mt-4",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"No.of QR Codes"})}),(0,p.jsx)("h6",{children:":"}),(0,p.jsx)("div",{className:"d-flex flex-column",children:I&&I.length>0?I.map(((e,t)=>(0,p.jsx)("div",{className:"d-flex flex-column",children:(0,p.jsxs)("p",{children:[e.serviceName," - ",e.titles.length," "]},t)}))):(0,p.jsx)("p",{children:"N/A"})})]}),(0,p.jsxs)("div",{className:"col-12 d-flex gap-4 mt-4",children:[(0,p.jsx)("div",{className:"col-3 d-flex align-items-center",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"Select Category"})}),(0,p.jsx)("h6",{className:"d-flex align-items-center",children:":"}),(0,p.jsx)("div",{className:"col-4",children:(0,p.jsx)(g.ZP,{isMulti:!0,options:2===I.length?[{value:"General Pest Control",label:"General Pest Control"},{value:"Rodent Pro",label:"Rodent Pro"}]:"General Pest Control"===Ge?[{value:"General Pest Control",label:"General Pest Control"}]:"Rodent Pro"===Ge?[{value:"Rodent Pro",label:"Rodent Pro"},{value:"General Pest Control",label:"General Pest Control"}]:0===I.length?[{value:"General Pest Control",label:"General Pest Control"}]:[],onChange:e=>{de(e),e&&ge(e.label);const t=e.map((e=>e.label));be(t),t.includes("General Pest Control")||(je(""),B([]));const s=t.some((e=>ue.includes(e)));if(s){e.filter((e=>t.includes(e.label)));const s=ce.filter((e=>t.includes(e.serviceName))).filter((e=>t.includes(e.serviceName)));ye(s)}},value:oe,isSearchable:!0})})]}),oe&&oe.map((e=>(0,p.jsx)(p.Fragment,{children:"General Pest Control"==e.label&&(0,p.jsxs)("div",{className:"col-12 d-flex gap-4 mt-4",children:[(0,p.jsx)("div",{className:"col-3 d-flex align-items-center",children:(0,p.jsxs)("div",{style:{fontWeight:"500"},children:["Select Subcategory for ",e.label]})}),(0,p.jsx)("h6",{className:"d-flex align-items-center",children:":"}),"Rodent Pro"===e.label?(0,p.jsx)("div",{className:"col-4",children:(0,p.jsx)("p",{children:"Rodent Pro"})}):(0,p.jsx)("div",{className:"col-4",children:(0,p.jsx)(g.ZP,{options:k.filter((t=>t.mainCategory===e.label)).map((e=>null===e||void 0===e?void 0:e.serviceName.map((e=>({value:e,label:e}))))).flat(),onChange:t=>(e=>{if(e){const t=e.value;$.some((e=>e.serviceName===t))||B([...$,{serviceName:t}]),je(e.value)}})(t,e.label),isSearchable:!0,placeholder:"Select Services",styles:$e})}),(0,p.jsx)("div",{className:"col-12 d-flex align-items-center",children:(0,p.jsx)("button",{id:"cbt",style:{fontSize:"13px"},onClick:()=>re("/add/details"),className:" btn btn-primary",children:"Add New Service"})})]},e.label)}))),oe&&(null===oe||void 0===oe?void 0:oe.map((e=>(0,p.jsxs)("div",{className:"col-12 d-flex gap-4 mt-2",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("h6",{className:"h6"})}),(0,p.jsx)("h6",{}),"General Pest Control"===e.label&&(0,p.jsx)("div",{className:"col-9",children:(0,p.jsx)("div",{className:"mt-2",children:null===$||void 0===$?void 0:$.map(((e,t)=>(0,p.jsxs)("div",{className:"col-6 d-flex mt-2 px-2",children:[(0,p.jsx)("div",{className:"col-8 d-flex justify-content-start align-items-center",children:(0,p.jsxs)("label",{style:{fontSize:"13px"},children:[t+1,". ",e.serviceName]})}),(0,p.jsx)("div",{className:"col-4 d-flex justify-content-end",children:(0,p.jsx)(v.gKM,{onClick:()=>{const e=[...$];e.splice(t,1),B(e),0===e.length&&je("")}})})]},t)))})})]},e.label)))),(0,p.jsxs)("div",{className:"d-flex gap-4 mt-4",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"Start Date"})}),(0,p.jsx)("h6",{children:":"}),(0,p.jsx)(n.Z,{format:{format:"DD-MM-YYYY",type:"mask"},disabledDate:e=>e&&e<u()().startOf("day"),onChange:e=>{D(e)},value:A})]}),(0,p.jsxs)("div",{className:"mt-3 mb-3",children:[(0,p.jsx)("div",{className:"col-3",children:(0,p.jsx)("div",{style:{fontWeight:"500"},children:"Description"})}),(0,p.jsx)("textarea",{value:G,onChange:e=>{R(e.target.value)},className:"form-control mt-2",id:"exampleFormControlTextarea1",rows:"5"})]})]})}),(0,p.jsxs)(c.Z.Footer,{children:[(0,p.jsx)(f.Z,{variant:"secondary",onClick:Fe,style:{fontSize:"13px"},children:"Close"}),(0,p.jsx)(f.Z,{variant:"primary",onClick:Ie,style:{fontSize:"13px"},children:"Create Task"})]})]}),(0,p.jsx)(x.Ix,{})]})}}}]);